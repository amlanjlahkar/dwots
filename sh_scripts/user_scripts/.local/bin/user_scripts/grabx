#!/bin/sh

# simple script that initializes X server recording using ffmpeg.

res="$(xdpyinfo | awk '/dimensions/ {print $2}')"
filepath="${HOME}/videos/screen-records/$(date +%F_%I%M%p).mp4"

# function to call when siginit is recieved
function trap_sigint() {
    echo "recording saved to \"${filepath}\"" &&
    exit 2
}
 
# initialise trap to call signint function 
trap "trap_sigint" 2

[ $1 ] && filename=$1 || filename="${filepath}"

ffmpeg \
    -loglevel error \
    -video_size "${res}"\
    -framerate 30 \
    -f x11grab -i :0.0 \
    -r 50 \
    -pix_fmt yuv420p \
    -c:v libx264 \
    -preset superfast \
    -stats \
    "$filename"

