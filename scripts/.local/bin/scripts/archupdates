#!/bin/sh

# simple script that periodically checks for arch package updates(only from the standard repositories, not AUR) and
# if there's any then sends a notification.
# dependencies: libnotify, dunst(or any other notification daemon).

# I use xinit for starting up X and this is where my xinitrc is located.
# change it to whatever your default path is.
# this is required for striping out the name of the window manager,
# which is later passed to ps for process check.
wm="$(tail -n 1 "${HOME}/.config/X11/xinitrc" | cut -d' ' -f2)"
psc="$(ps -e --format=cmd | grep "^${wm}$" 2> /dev/null)"

while :; do
    pacman_update_count="$(checkupdates | wc -l)"
    aur_update_count="$(yay -Qu | wc -l)"
    update_count="$(("${pacman_update_count}" + "${aur_update_count}"))"
    if [ -n "${psc}" ]; then
        [ "${update_count}" -eq 0 ] && echo 'clean' &> /dev/null || notify-send "ğŸ“¦ Updates Available" \
            "You have "${update_count}" upadate(s) pending" && sleep 3h       # change this to your preferred count.
    else
        echo 'X server not running'
        break 1
    fi
done
